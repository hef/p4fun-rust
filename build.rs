fn main() {
    let includes = [
        "p4source/sys",
        "p4source/support",
        "p4source/i18n",
        "p4source/rpc",
        "p4source/msgs",
        "p4source/net",
        "p4source/dme",
        "p4source/diff",
        "p4source/client",
        "p4source/dmec",
        "p4source/script",
        "p4source/map",
        "p4source/zlib",
        "src",
    ];

    let mut b = autocxx_build::Builder::new("src/main.rs", &includes)
        .extra_clang_args(&["-std=c++17"])
        .build()
        .unwrap();
    b.flag_if_supported("-std=c++17");
    b.compile("p4bindings");
    println!("cargo:rerun-if-changed=src/main.rs");

    cc::Build::new()
        .flag_if_supported("-Wno-everything")
        .cpp(true) // Switch to C++ library compilation.
        .define("OS_MACOSX", None)
        .define("OS_VER", "1015")
        .define("ID_OS", r#""osx""#)
        .define("ID_REL", r#""2020.2.2697822-local-dev-build""#)
        .define("ID_PATCH", r#""9999999""#)
        .define("ID_Y", r#""2100""#)
        .define("ID_M", r#""01""#)
        .define("ID_D", r#""01""#)
        .define("USE_SSL", None)
        .define("OPENSSL_API_COMPAT", "30000")
        .define("OPENSSL_NO_DEPRECATED", None)
        .include("p4source/sys")
        .include("p4source/support")
        .include("p4source/i18n")
        .include("p4source/rpc")
        .include("p4source/msgs")
        .include("p4source/net")
        .include("p4source/dme")
        .include("p4source/diff")
        .include("p4source/client")
        .include("p4source/dmec")
        .include("p4source/script")
        .include("p4source/map")
        .include("p4source/zlib")
        .file("p4source/client/client.cc")
        .file("p4source/client/clientapi.cc")
        .file("p4source/client/clientaltsynchandler.cc")
        .file("p4source/client/clientenv.cc")
        .file("p4source/client/clienti18n.cc")
        .file("p4source/client/clientinit.cc")
        .file("p4source/client/clientlegal.cc")
        .file("p4source/client/clientmerge.cc")
        .file("p4source/client/clientmerge2.cc")
        .file("p4source/client/clientmerge3.cc")
        .file("p4source/client/clientprog.cc")
        .file("p4source/client/clientrcvfiles.cc")
        .file("p4source/client/clientreplicate.cc")
        .file("p4source/client/clientresolvea.cc")
        .file("p4source/client/clientservice.cc")
        .file("p4source/client/clientservicer.cc")
        .file("p4source/client/clienttrust.cc")
        .file("p4source/client/clientuser.cc")
        .file("p4source/client/clientusercolor.cc")
        .file("p4source/client/clientuserdbg.cc")
        .file("p4source/client/clientusermsh.cc")
        .file("p4source/client/clientusernull.cc")
        .file("p4source/client/p4libs.cc")
        .file("p4source/client/serverhelper.cc")
        .file("p4source/client/serverhelperapi.cc")
        .file("p4source/diff/diff.cc")
        .file("p4source/diff/diffan.cc")
        .file("p4source/diff/diffflags.cc")
        .file("p4source/diff/diffmerge.cc")
        .file("p4source/diff/diffmulti.cc")
        .file("p4source/diff/diffmultimulti.cc")
        .file("p4source/diff/diffsp.cc")
        .file("p4source/diff/diffsr.cc")
        .file("p4source/i18n/charcvt.cc")
        .file("p4source/i18n/charman.cc")
        .file("p4source/i18n/charset.cc")
        .file("p4source/i18n/charfold.cc")
        .file("p4source/i18n/basecvt.cc")
        .file("p4source/i18n/i18napi.cc")
        .file("p4source/i18n/simplecvt.cc")
        .file("p4source/i18n/unicvt.cc")
        .file("p4source/i18n/transdict.cc")
        .file("p4source/i18n/jptables.cc")
        .file("p4source/i18n/krtables.cc")
        .file("p4source/i18n/cn936.cc")
        .file("p4source/i18n/cn950.cc")
        .file("p4source/i18n/validate.cc")
        .file("p4source/map/mapchar.cc")
        .file("p4source/map/maphalf.cc")
        .file("p4source/map/mapitem.cc")
        .file("p4source/map/mapjoin.cc")
        .file("p4source/map/mapstring.cc")
        .file("p4source/map/maptable.cc")
        .file("p4source/msgs/msgclient.cc")
        .file("p4source/msgs/msgconfig_wrap.cc")
        .file("p4source/msgs/msgdb.cc")
        .file("p4source/msgs/msgdm.cc")
        .file("p4source/msgs/msgdm2.cc")
        .file("p4source/msgs/msggraph.cc")
        .file("p4source/msgs/msghelp_wrap.cc")
        .file("p4source/msgs/msglbr.cc")
        .file("p4source/msgs/msgos.cc")
        .file("p4source/msgs/msgrpc.cc")
        .file("p4source/msgs/msgscript.cc")
        .file("p4source/msgs/msgserver.cc")
        .file("p4source/msgs/msgserver2.cc")
        .file("p4source/msgs/msgspec.cc")
        .file("p4source/msgs/msgsupp.cc")
        .file("p4source/msgs/p4tagl.cc")
        .file("p4source/msgs/p4tags.cc")
        .file("p4source/net/netbuffer.cc")
        .file("p4source/net/netconnect.cc")
        .file("p4source/net/netaddrinfo.cc")
        .file("p4source/net/netipaddr.cc")
        .file("p4source/net/netmulti.cc")
        .file("p4source/net/netportparser.cc")
        .file("p4source/net/netprotectaddr.cc")
        .file("p4source/net/netstd.cc")
        .file("p4source/net/netsslcredentials.cc")
        .file("p4source/net/netsslendpoint.cc")
        .file("p4source/net/netssltransport.cc")
        .file("p4source/net/nettcpendpoint.cc")
        .file("p4source/net/nettcptransport.cc")
        .file("p4source/net/netutils.cc")
        .file("p4source/rpc/rpc.cc")
        .file("p4source/rpc/rpcbuffer.cc")
        .file("p4source/rpc/rpcdebug.cc")
        .file("p4source/rpc/rpcdispatch.cc")
        .file("p4source/rpc/rpcfwd.cc")
        .file("p4source/rpc/rpcmulti.cc")
        .file("p4source/rpc/rpcservice.cc")
        .file("p4source/rpc/rpctrans.cc")
        .file("p4source/support/base64.cc")
        .file("p4source/support/bitarray.cc")
        .file("p4source/support/contextpat.cc")
        .file("p4source/support/datetime.cc")
        .file("p4source/support/debug.cc")
        .file("p4source/support/digest.cc")
        .file("p4source/support/error.cc")
        .file("p4source/support/errormsh.cc")
        .file("p4source/support/errorsys.cc")
        .file("p4source/support/handler.cc")
        .file("p4source/support/hash.cc")
        .file("p4source/support/ident.cc")
        .file("p4source/support/ignore.cc")
        .file("p4source/support/intarray.cc")
        .file("p4source/support/jnlpos.cc")
        .file("p4source/support/jnltrack.cc")
        .file("p4source/support/jsonescapes.cc")
        .file("p4source/support/mangle.cc")
        .file("p4source/support/mapapi.cc")
        .file("p4source/support/md5.cc")
        .file("p4source/support/objhashmap.cc")
        .file("p4source/support/options.cc")
        .file("p4source/support/progress.cc")
        .file("p4source/support/random.cc")
        .file("p4source/support/regmatch.cc")
        .file("p4source/support/regexp.cc")
        .file("p4source/support/serverid.cc")
        .file("p4source/support/sha1.cc")
        .file("p4source/support/sha256.cc")
        .file("p4source/support/spec.cc")
        .file("p4source/support/specchar.cc")
        .file("p4source/support/specdata.cc")
        .file("p4source/support/specdef.cc")
        .file("p4source/support/specparse.cc")
        .file("p4source/support/splr.cc")
        .file("p4source/support/strarray.cc")
        .file("p4source/support/strbuf.cc")
        .file("p4source/support/strdict.cc")
        .file("p4source/support/strops.cc")
        .file("p4source/support/strtable.cc")
        .file("p4source/support/strtree.cc")
        .file("p4source/support/strxml.cc")
        .file("p4source/support/ticket.cc")
        .file("p4source/support/tracker.cc")
        .file("p4source/support/utils.cc")
        .file("p4source/support/uuid.cc")
        .file("p4source/support/uuidweak.cc")
        .file("p4source/support/vararray.cc")
        .file("p4source/support/varlist.cc")
        .file("p4source/support/varqsort.cc")
        .file("p4source/support/vartree.cc")
        .file("p4source/support/trienode.cc")
        .file("p4source/sys/applefork.cc")
        .file("p4source/sys/echoctl.cc")
        .file("p4source/sys/enviro.cc")
        .file("p4source/sys/errorlog.cc")
        .file("p4source/sys/fblreader.cc")
        .file("p4source/sys/filecheck.cc")
        .file("p4source/sys/filegen.cc")
        .file("p4source/sys/filedirs.cc")
        .file("p4source/sys/fileio.cc")
        .file("p4source/sys/fileiobuf.cc")
        .file("p4source/sys/fileiosym.cc")
        .file("p4source/sys/fileiouni.cc")
        .file("p4source/sys/fileiozip.cc")
        .file("p4source/sys/filemkdir.cc")
        .file("p4source/sys/fileopt.cc")
        .file("p4source/sys/filespace.cc")
        .file("p4source/sys/filestrbuf.cc")
        .file("p4source/sys/filesys.cc")
        .file("p4source/sys/filetmp.cc")
        .file("p4source/sys/hostcfg.cc")
        .file("p4source/sys/hostenv.cc")
        .file("p4source/sys/fdutil.cc")
        .file("p4source/sys/memfile.cc")
        .file("p4source/sys/monitem.cc")
        .file("p4source/sys/microthread.cc")
        .file("p4source/sys/pathmac.cc")
        .file("p4source/sys/pathnt.cc")
        .file("p4source/sys/pathunix.cc")
        .file("p4source/sys/pathsys.cc")
        .file("p4source/sys/pathvms.cc")
        .file("p4source/sys/pid.cc")
        .file("p4source/sys/pipeio.cc")
        .file("p4source/sys/pressuremonitor.cc")
        .file("p4source/sys/proc_utils.cc")
        .file("p4source/sys/readfile.cc")
        .file("p4source/sys/resvmem.cc")
        .file("p4source/sys/runcmd.cc")
        .file("p4source/sys/rusage.cc")
        .file("p4source/sys/signaler.cc")
        .file("p4source/sys/stdhdrs.cc")
        .file("p4source/sys/sysinfo.cc")
        .file("p4source/sys/sysinfo-resource.cc")
        .file("p4source/sys/threading.cc")
        .file("p4source/sys/timer.cc")
        .file("p4source/sys/zfilestream.cc")
        .file("p4source/sys/zipfile.cc")
        .file("p4source/sys/zlinflater.cc")
        .file("p4source/sys/zlmeminflater.cc")
        .file("p4source/sys/gzip.cc")
        // begin mac only
        //.file("p4source/sys/macfile.cc")
        //.file("p4source/sys/fileioappm.cc")
        //.file("p4source/sys/fileiomac.cc")
        .file("p4source/sys/fileioapp.cc")
        .file("p4source/sys/macutil.m")
        // end mac only
        .compile("cppcode");

    cc::Build::new()
        .cpp(false) // redundent, but makes it obvious
        .include("p4source/zlib")
        .include("p4source/i18n")
        .include("p4source/sys")
        .define("Z_PREFIX", None)
        .flag_if_supported("-Wno-deprecated-non-prototype") // only for ioapi.c
        .flag_if_supported("-Wno-everything")
        .file("p4source/sys/unzip.c")
        .file("p4source/sys/zip.c")
        .file("p4source/sys/ioapi.c")
        .file("p4source/zlib/x86.c")// not sure why this is missing from local zlib
        .compile("ccode");
}
